{% extends 'base.html.twig' %}

{% block title %}Créer une réservation{% endblock %}

{% block body %}
    <div class="container">
        <h1 class="my-4">Réserver un créneau</h1>

        <div id="flash-messages"></div>

        <div id="form-container">
            {% include 'reservation/_form.html.twig' with {'form': form} %}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function() {
            // Initialisation des gestionnaires de formulaire
            function initFormHandlers() {
                $('.reservation-form').off('submit').on('submit', function(e) {
                    e.preventDefault();
                    const form = $(this);
                    
                    $.ajax({
                        url: form.attr('action'),
                        type: form.attr('method'),
                        data: form.serialize(),
                        dataType: 'json',
                        success: function(data) {
                            if (data.success) {
                                window.location.href = '{{ path('reservation_index') }}';
                            } else {
                                showFlashMessage('error', data.message);
                            }
                        }
                    });
                });
            }

            // Fonction pour afficher les messages flash
            function showFlashMessage(type, message) {
                const flashDiv = $('<div class="alert alert-' + type + ' alert-dismissible fade show" role="alert">' +
                    message +
                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>' +
                    '</div>');
                
                $('#flash-messages').append(flashDiv);
                
                // Supprimer après 5 secondes
                setTimeout(() => {
                    flashDiv.remove();
                }, 5000);
            }

            // Initialisez les gestionnaires au chargement
            initFormHandlers();
        });
    </script>
{% endblock %}